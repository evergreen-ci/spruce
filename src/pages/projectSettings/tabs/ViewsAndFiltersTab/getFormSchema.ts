import { CardFieldTemplate } from "components/SpruceForm/FieldTemplates";
import widgets from "components/SpruceForm/Widgets";
import { GetFormSchema } from "../types";
import { CaseSensitivity, MatchType } from "./types";

export const getFormSchema = (): ReturnType<GetFormSchema> => ({
  fields: {},
  schema: {
    type: "object" as "object",
    properties: {
      projectHealthView: {
        title: "Project Health View",
        type: "object" as "object",
      },
      parsleyFilters: {
        title: "Parsley Filters",
        type: "array" as "array",
        default: [],
        items: {
          type: "object" as "object",
          properties: {
            expression: {
              type: "string" as "string",
              title: "Filter Expression",
              minLength: 1,
              default: "",
              format: "validRegex",
            },
            caseSensitivity: {
              type: "string" as "string",
              title: "Case",
              default: CaseSensitivity.Insensitive,
              oneOf: [
                {
                  type: "string" as "string",
                  title: "Insensitive",
                  enum: [CaseSensitivity.Insensitive],
                },
                {
                  type: "string" as "string",
                  title: "Sensitive",
                  enum: [CaseSensitivity.Sensitive],
                },
              ],
            },
            matchType: {
              type: "string" as "string",
              title: "Match",
              default: MatchType.Exact,
              oneOf: [
                {
                  type: "string" as "string",
                  title: "Exact",
                  enum: [MatchType.Exact],
                },
                {
                  type: "string" as "string",
                  title: "Inverse",
                  enum: [MatchType.Inverse],
                },
              ],
            },
          },
        },
      },
    },
  },
  uiSchema: {
    projectHealthView: {
      "ui:ObjectFieldTemplate": CardFieldTemplate,
    },
    parsleyFilters: {
      "ui:addButtonText": "Add new filter",
      "ui:orderable": false,
      "ui:description":
        "The filters will be available within the Parsley log viewer for any logs generated by this project.",
      "ui:useExpandableCard": true,
      "ui:data-cy": "parsley-filters-list",
      items: {
        "ui:displayTitle": "New Parsley Filter",
        expression: {
          "ui:data-cy": "filter-expression",
        },
        caseSensitivity: {
          "ui:widget": widgets.SegmentedControlWidget,
          "ui:sizeVariant": "small",
          "ui:aria-controls": ["case-insensitive", "case-sensitive"],
          "ui:data-cy": "filter-case-sensitivity",
        },
        matchType: {
          "ui:widget": widgets.SegmentedControlWidget,
          "ui:sizeVariant": "small",
          "ui:aria-controls": ["exact-match", "inverse-match"],
          "ui:data-cy": "filter-match-type",
        },
      },
    },
  },
});
